<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>Անելիքներ</title>
<script>

    var uni_input = document.createElement('input');
    uni_input.onblur = function()
    {
        if(0 < uni_input.value.length) {
            uni_item.innerText = uni_input.value;
            update_state(uni_item);
        }
        uni_input.replaceWith(uni_item);
        return false;
    }
    var uni_item = null;

    function empty_false() { return false; }

    function set_normal()
    {
        this.state = 0;
        this.onclick = set_important;
        this.oncontextmenu = edit_item;
        this.innerHTML = this.innerText.normalize();
    }
    
    function set_important()
    {
        this.state = 1;
        this.onclick = set_inprogress;
        this.oncontextmenu = edit_item;
        this.innerHTML = this.innerText.bold();
    }

    function set_inprogress()
    {
        this.state = 2;
        this.onclick = set_completed;
        this.oncontextmenu = edit_item;
        this.innerHTML = this.innerText.italics();
    }

    function set_completed()
    {
        this.state = 3;
        this.onclick = set_normal;
        this.oncontextmenu = delete_item;
        this.innerHTML = this.innerText.strike();
    }

    function update_state(item)
    {
        var state_proc_arr = [
            set_normal,
            set_important,
            set_inprogress,
            set_completed
        ];
        state_proc_arr[item.state].call(item);
    }

    function edit_item()
    {
        console.log("edit_item");
        uni_item = this;
        uni_input.value = this.innerText;
        this.replaceWith(uni_input);
        uni_input.focus();

        return false;
    }

    function delete_item()
    {
        console.log("delete_item");
        if(confirm("Հաստատեք որ ուզում եք ջնջել՝\n\n" + this.innerText)) {
            this.remove();
        }
        return false;
    }

    var add_item = function()
    {
        var item = document.createElement("li");
        item.innerText      = "<Նոր անելիք>";
        item.style          = "cursor:default";
        item.onselectstart  = empty_false;
        set_normal.call(item);
        sp.appendChild(item);
    }
</script>
</head>
<body>
<h3>Անելիքներ</h3>
    <div id="sp">
    </div>
    <hr>
    <a href='javascript:add_item();'>Ավելացնել նորը</a>
</body>
</html>
