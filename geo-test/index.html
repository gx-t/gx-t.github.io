<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel=manifest href=./manifest.json>
<title>Geo Test</title>

<style>
html, body {
    height: 100%;
    margin:0;
    background-color: black;
}
</style>

<script>
var ctx = null;
var w = 0;
var h = 0;
var gps = {coords: {altitude: 0,speed: 0}};
var gps_color = "#777777FF";

keep_awake = async function() {
    if(!navigator.wakeLock)
        return;
    try {await navigator.wakeLock.request('screen');} catch (err) {console.log(err);}
}

draw_portrait = function() {
    var center = w / 2;
    var quarter = center / 2;
    ctx.font = quarter / 2 + 'pt Calibri';
    ctx.fillText(Math.round(gps.coords.altitude), quarter, quarter / 2); 
    ctx.fillText(Math.round(3.6 * gps.coords.speed), center + quarter, quarter / 2); 
}

draw_landscape = function() {
    var center = h / 2;
    var quarter = center / 2;
    ctx.font = quarter / 2 + 'pt Calibri';
    ctx.fillText(Math.round(gps.coords.altitude), quarter, quarter / 2); 
    ctx.fillText(Math.round(3.6 * gps.coords.speed), quarter, quarter + quarter / 2); 
}

draw = function() {
    w = cs.width;
    h = cs.height;
    ctx.fillStyle = gps_color;
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'center';
    ctx.clearRect(0, 0, w, h);
    if(w > h)
        return draw_landscape(ctx, w, h);
    draw_portrait(ctx, w, h);
}

update = function() {
    window.requestAnimationFrame(draw);
}

window.onload = function() {
    keep_awake();
    ctx = cs.getContext("2d");
    window.onresize();

    if(!navigator.geolocation)
        return;

    navigator.geolocation.watchPosition(function(gg) {gps = gg;gps_color="#00FFFFFF";update();},function(error) {gps_color="#777777FF";update();},{ enableHighAccuracy: true });
}

window.onresize = function() {
    cs.width = window.innerWidth;
    cs.height = window.innerHeight;
    update();
}

document.onvisibilitychange = function() {
    if("visible" === document.visibilityState)
        keep_awake();
}
</script>
</head>
<body>
<canvas id='cs'></canvas>
</body>
</html>

